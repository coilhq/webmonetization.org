---
id: api
title: API
sidebar_label: API
---
 
If a user visits your page and has Web Monetization enabled, your site can
detect that Web Monetization is enabled.

You can access Web Monetization-related events and state through a Javascript
API on `document.monetization`.

## Javascript API
```ts
document.monetization: EventTarget
document.monetization.state: string
```

This Javascript API is injected by any browser or extension that supports Web
Monetization. 

> You don't need to include any files to use this Javascript API.

Check the value of `document.monetization.state` to see if the user visiting
your page is Web Monetized.

There are 3 possible states for Web Monetization.

### No Web Monetization

```ts
document.monetization === undefined
```

The user does not support Web Monetization, or there is no **Web Monetization Meta Tag** on the page.

### Pending

```ts
document.monetization && document.monetization.state === 'pending'
```

The user is capable of Web Monetization. The [Web Monetization Service Provider](/#providers) is starting to send a streaming payment with Interledger.

If the user is Web Monetized, the `document.monetization.state` will always begin in this state.

### Started

```ts
document.monetization && document.monetization.state === 'started'
```

The user is Web Monetized and the [Web Monetization Service Provider](/#providers) is actively streaming payments to your site with Interledger.

It can take a couple of seconds for `document.monetization.state` to go from
`pending` to `started`. The events described below can be used to listen for a
change in `document.monetization.state`.

## Browser Events

### `monetizationstart`

```ts
function startEventHandler (event) {
  console.log(event)
}

document
  .monetization
  .addEventListener('monetizationstart', startEventHandler)
```
*Event Object*

Field | Value | Details
--- | --- | ---
paymentPointer | String | The `paymentPointer` matches the one in the `<meta name="monetization">` tag.
requestId | String | The `requestId` matches the Monetization ID (UUID V4) generated by the browser (see [Flow](/docs/explainer#flow)). 

*Example Event Object*

```ts
{ 
  detail: {
    paymentPointer: "$twitter.xrptipbot.com/Interledger",
    requestId: "ec4f9dec-0ba4-4029-8f6a-29dc21f2e0ce" 
  }
}
```

The `monetizationstart` event can be listened to determine when Web Monetization has started. To use it add an event listener to document.monetization. 

### `monetizationprogress` 

```ts
function progressEventHandler (event) {
  console.log(event)
}

document
  .monetization
  .addEventListener('monetizationprogress', progressEventHandler)
```

*Event Object*

Field | Value | Details 
--- | --- | ---
amount | String | String containing the destination amount received as specified in the ILP packet.
assetCode | String | The three letter asset code describing the amount's units.
assetScale | Number | A number representing the scale of the amount. For example, cents would have an assetScale of 2.

*Example Event Object*

```ts
{ 
  detail: {
    amount: "75673",
    assetCode: "XRP",
    assetScale: 9
  }
}
```

The `monetizationprogress` event can be listened to show the current status of the STREAMing payment. To use it add an event listener to document.monetization. 

## HTTP Headers

### `Web-Monetization-Id`

Contains the `Monetization ID` (currently referred to as `requestId` in the events) that the browser generated. This header MUST always be sent on SPSP queries for Web Monetization. This value MUST be a UUID version 4.

```http
Web-Monetization-Id: dcd479ad-7d8d-4210-956a-13c14b8c67eb
```
